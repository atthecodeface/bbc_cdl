<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CDL Modules: riscv_csrs_minimal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CDL Modules
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">riscv_csrs_minimal</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:riscv__csrs__minimal_8cdl"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="riscv__csrs__minimal_8cdl.html">riscv_csrs_minimal.cdl</a></td></tr>
<tr class="memdesc:riscv__csrs__minimal_8cdl"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control/status registers for a minimal RISC-V implementation. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Modules</h2>
<a class="anchor" id="gad5fa69668e8460baf5827fb5dc728958"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module riscv_csrs_minimal::riscv_csrs_minimal </td>
          <td>(</td>
          <td class="paramtype">clock&#160;</td>
          <td class="paramname"><em>clk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input bit&#160;</td>
          <td class="paramname"><em>reset_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input <a class="el" href="riscv_8h.html#structt__riscv__irqs">t_riscv_irqs</a>&#160;</td>
          <td class="paramname"><em>irqs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input <a class="el" href="riscv__internal__types_8h.html#structt__riscv__csr__access">t_riscv_csr_access</a>&#160;</td>
          <td class="paramname"><em>csr_access</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input <a class="el" href="riscv_8h.html#a4a3672c17779a47f3ca095d7d9bd7cc6">t_riscv_word</a>&#160;</td>
          <td class="paramname"><em>csr_write_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">output <a class="el" href="riscv__internal__types_8h.html#structt__riscv__csr__data">t_riscv_csr_data</a>&#160;</td>
          <td class="paramname"><em>csr_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input <a class="el" href="riscv__internal__types_8h.html#structt__riscv__csr__controls">t_riscv_csr_controls</a>&#160;</td>
          <td class="paramname"><em>csr_controls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">output <a class="el" href="riscv__internal__types_8h.html#structt__riscv__csrs__minimal">t_riscv_csrs_minimal</a>&#160;</td>
          <td class="paramname"><em>csrs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This module implements a minimal set of RISC-V CSRs, as per v2.1 (May 2016) of the RISC-V instruction set manual user level ISA and v1.9.1 of the privilege architecture (Nov 2016), with the exception that MTIME has been removed (as this seems to be the correct thing to do).</p>
<p>The privilege specifcation (v1.10) indicates:</p>
<p>meip is read-only and is derived from the external irq in to this module</p>
<p>mtip is read-only, cleared by writing to the memory-mapped timer comparator</p>
<p>msip is read-write in a memory-mapped register somewhere</p>
<p>Hence the irqs structure must provide these three signals</p>
<p>Minimal CSRs as only machine mode and debug mode are supported. In debug mode every register access is supported. In machine mode then every register EXCEPT access to ??? is supported.</p>
<p>Given machine mode is the only mode supported:</p>
<p>there are no SEI and UEI interrupt pins in to this module</p>
<p>SEIP and UEIP are not supported</p>
<p>STIP and UTIP are not supported</p>
<p>SSIP and USIP are not supported</p>
<p>mstatus.SIE and mstatus.UIE (and previous versions) are hardwired to 0</p>
<p>mstatus.SPP and mstatus.UPP are hardwired to 0</p>
<p>The mip (machine interrupt pending register) therefore is:</p>
<p>{20b0, MEIP, 3b0, MTIP, 3b0, MSIP, 3b0}</p>
<p>The mie (machine interrupt enable register) is:</p>
<p>{20b0, MEIE, 3b0, MTIE, 3b0, MSIE, 3b0}</p>
<p>The instruction to the pipeline to request an interrupt (which is only taken if an instruction is in uncommitted in the execution stage) must be generated using the execution mode and the interrupt enable bits and the interrupt pending bits.</p>
<p>Hence the 'take interrupt' is (mip &amp; mie) != 0 &amp;&amp; mstatus.MIE &amp;&amp; (current mode &gt;= machine mode) &amp;&amp; (current mode != debug mode).</p>
<p>The required priority order is:</p>
<p>external interrupts, software interrupts, timer interrupts</p>
<p>If an instruction has been committed then it may trap, and the trap will occur prior to an interrupt which happens after the commit point. In this case there will be a trap, and the trapped instruction will be fetched, and then an interrupt can be taken.</p>
<p>When an interrupt is taken the following occurs:</p>
<p>MPP &lt;= current execution mode (must be machine mode, as debug mode is not interruptible)</p>
<p>mstatus.MPIE &lt;= mstatus.MIE</p>
<p>Note that WFI should wait independent of mstatus.MIE for (mip &amp; mie) != 0 (given machine mode only) In debug mode WFI should be a NOP.</p>
<p>WFI may always be a NOP. </p>
<p>Scratch debug write</p>
<p>write_data</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">clk</td><td>RISC-V clock </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reset_n</td><td>Active low reset </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">irqs</td><td>Interrupts in to the CPU </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">csr_access</td><td>RISC-V CSR access, combinatorially decoded </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">csr_write_data</td><td>Write data for the CSR access, later in the cycle than  possibly </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">csr_data</td><td>CSR respone (including read data), from the current <em>csr_access</em> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">csr_controls</td><td>Control signals to update the CSRs </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">csrs</td><td>CSR values </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Sep 30 2018 17:21:43 for CDL Modules by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
