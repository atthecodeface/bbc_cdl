<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CDL Modules: cdl/jtag/src/jtag_apb.cdl File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CDL Modules
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_b89025be567f5b6d36b8bc23257fdaf4.html">cdl</a></li><li class="navelem"><a class="el" href="dir_6fcd04c169b12e2a1a34530f2c170676.html">jtag</a></li><li class="navelem"><a class="el" href="dir_33ab9bed17a8a368b0265d7949d8af75.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">jtag_apb.cdl File Reference<div class="ingroups"><a class="el" href="group__riscv__jtag__apb__dm.html">riscv_jtag_apb_dm</a> &#124; <a class="el" href="group__jtag__apb.html">jtag_apb</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>JTAG tap client to APB master module.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>JTAG tap client to APB master module. </p>
<p>Copyright (C) 2018, Gavin J Stark. All rights reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p>CDL implementation of a module that, with <a class="el" href="namespacejtag__tap.html">jtag_tap</a>, forms an APB bus master that is driven by a JTAG interface.</p>
<p>It is based on the RISC-V DTM JTAG interface module, in that it supports a 5-bit IR (that is specified in the build of <a class="el" href="namespacejtag__tap.html">jtag_tap</a>) and an IDCODE register accessed with IR=1; a control/status register accessed with IR=0x10, and an access register accessed with IR=0x11.</p>
<p>The IDCODE register is 32-bits long (as required by the JTAG standard) and must have the bottom bit set; it is defined as a constant, so a build of this module can override that to provide the desired IDCODE value for the JTAG TAP.</p>
<p>The 32-bit CONTROL register (at IR=0x10) returns, on reads, an op_status in bits [2;10], an abits of 16 in <a href="i.e. the module supports
16 address bits in its ACCESS register">6;4</a> and a version of 1 in [4;0] The op_status is a sticky status; it is sticky at 2 if an APB access is attempted while a previous access is being performed. This can be cleared with a write of 0x10000 to the CONTROL register.</p>
<p>Currently the CONTROL register does not support a hard reset of the DTM; it is not clear that this makes sense in an APB access.</p>
<p>The 50-bit ACCESS register (at IR=0x11) is used to perform APB read and writes; it is a 50-bit register (16-bit address, 32-bit data, 2-bit access type) register.</p>
<p>If the access type is 0 then no access is requested; this is used when a JTAG readback is to be used to return a previous APB read's data.</p>
<p>If the access type is 1 then a read access is requested; the top 16 bits of the JTAG data shifted in are the address to be accessed; the next 32 bits are ignored; the access is 1. An APB read access is requested through synchronization registers between the JTAG clock and the APB clock. The APB transaction completes and the data returned is captured and stored ready to be returned in future 'capture's of the ACCESS register.</p>
<p>If the access type is 2 then a write access is requested; the top 16 bits of the JTAG data shifted in are the address to be accessed; the next 32 bits are used as the write data; the access is 2. An APB write access is requested through synchronization registers between the JTAG clock and the APB clock.</p>
<p>If the ACCESS register is read then the bottom 2 bits returned are the op_status - this is 3 if any previous APB access was interrupted and therefore did not complete (read or write) successfully, otherwise it is 0; the next 32 bits are the last APB data read, and the top 16 bits are the last APB address accessed.</p>
<p>The normal usage for writes is to JTAG-shift in address(16)/data(32)/2(2) to the ACCESS register. The APB access will complete before any other JTAG operation can cause problems, so these writes can be performed back-to-back.</p>
<p>The normal usage for reads is to JTAG-shift in address(16)/data(32)/1(2) to the ACCESS register; then a further JTAG-shift of the ACCESS register permits the APB read data to be captured and shifted out. The APB access will take time to complete, and it is possible (with a fast JTAG TCK compared to APB clock) to JTAG-shift to CAPTURE the ACCESS register complete before the APB access returns its data; if this happens then the CAPTURE (read) of the ACCESS register will have an op_status of 3 (and this is sticky - it needs a write of 0x10000 to CONTROL to clear it). So the correct modus operandi is to start the APB read, hang in idle for a few cycles, then capture the APB response. The request and data have to be cacptured, and there are 2 registers for synchonization in each direction, and there are three clock crossings in each direction for an APB read, hence at least 7 cycles are required between Update and Capture, and it is wise to therefore stay in JTAG IDLE for 7 ticks. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structjtag__apb_1_1t__jtag__state"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jtag__apb.html#structjtag__apb_1_1t__jtag__state">jtag_apb::t_jtag_state</a></td></tr>
<tr class="separator:structjtag__apb_1_1t__jtag__state"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structjtag__apb_1_1t__apb__state"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jtag__apb.html#structjtag__apb_1_1t__apb__state">jtag_apb::t_apb_state</a></td></tr>
<tr class="separator:structjtag__apb_1_1t__apb__state"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacejtag__apb"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacejtag__apb.html">jtag_apb</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga8a8ec7cba635a1217fafff5e3c937399"><td class="memItemLeft" align="right" valign="top">typedef bit[3]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jtag__apb.html#ga8a8ec7cba635a1217fafff5e3c937399">jtag_apb::t_sync</a></td></tr>
<tr class="separator:ga8a8ec7cba635a1217fafff5e3c937399"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga565f89925eb88cb5677483b0a12d8d5e"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jtag__apb.html#ga565f89925eb88cb5677483b0a12d8d5e">jtag_apb::t_update_action</a> { <br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga565f89925eb88cb5677483b0a12d8d5eae74d2b0352ef3ad39bf3e97d0b3d3a9a">jtag_apb::action_none</a>, 
<br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga565f89925eb88cb5677483b0a12d8d5ea15363e7ae1759dd604fad4c88543b960">jtag_apb::action_reset</a>, 
<br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga565f89925eb88cb5677483b0a12d8d5ea5fc114a32e4148eb1b5845d55bdc9329">jtag_apb::action_start_read</a>, 
<br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga565f89925eb88cb5677483b0a12d8d5eaf133d6449b3239345fb06ced103f3130">jtag_apb::action_start_write</a>
<br />
 }</td></tr>
<tr class="separator:ga565f89925eb88cb5677483b0a12d8d5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8c43fccf22bfcea57e32a591a1c7e417"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jtag__apb.html#ga8c43fccf22bfcea57e32a591a1c7e417">jtag_apb::t_jtag_addr</a> { <br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga8c43fccf22bfcea57e32a591a1c7e417a23d7c3b3e5dd2ba72e0e411699f3ab1f">jtag_apb::jtag_addr_idcode</a> = 1, 
<br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga8c43fccf22bfcea57e32a591a1c7e417a6d121311cc1583ad053724974e6379ca">jtag_apb::jtag_addr_apb_control</a> = 0x10, 
<br />
&#160;&#160;<a class="el" href="group__jtag__apb.html#gga8c43fccf22bfcea57e32a591a1c7e417a65d6a9bb90edc4093666bd848cfec97e">jtag_apb::jtag_addr_apb_access</a> = 0x11
<br />
 }</td></tr>
<tr class="separator:ga8c43fccf22bfcea57e32a591a1c7e417"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:gafc66970571a65aa093e56f3977d7158a"><td class="memItemLeft" align="right" valign="top">constant bit[32]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jtag__apb.html#gafc66970571a65aa093e56f3977d7158a">jtag_apb::jtag_idcode</a> =0xabcde6e3</td></tr>
<tr class="separator:gafc66970571a65aa093e56f3977d7158a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Sep 30 2018 17:21:43 for CDL Modules by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
