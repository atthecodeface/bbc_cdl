<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CDL Modules: led_ws2812_chain</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CDL Modules
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">led_ws2812_chain</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:led__ws2812__chain_8cdl"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="led__ws2812__chain_8cdl.html">led_ws2812_chain.cdl</a></td></tr>
<tr class="memdesc:led__ws2812__chain_8cdl"><td class="mdescLeft">&#160;</td><td class="mdescRight">'Neopixel' LED chain driver module <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Modules</h2>
<a class="anchor" id="ga66e5d87b93944d66e16b6c6cde1061cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">module led_ws2812_chain::led_ws2812_chain </td>
          <td>(</td>
          <td class="paramtype">clock&#160;</td>
          <td class="paramname"><em>clk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input bit&#160;</td>
          <td class="paramname"><em>reset_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input bit&#160;</td>
          <td class="paramname"><em>divider_400ns</em>[8], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">output <a class="el" href="leds_8h.html#structt__led__ws2812__request">t_led_ws2812_request</a>&#160;</td>
          <td class="paramname"><em>led_request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">input <a class="el" href="leds_8h.html#structt__led__ws2812__data">t_led_ws2812_data</a>&#160;</td>
          <td class="paramname"><em>led_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">output bit&#160;</td>
          <td class="paramname"><em>led_chain</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A chain of any length of Neopixel LEDs can be driven by this module</p>
<p>The interface is a request/data interface; this module presents a <em>ready</em> request to the client, which then presents a valid 24-bit RGB data value. When the module takes the data it removes its <em>ready</em> request. The client keeps supplying data in response to the <em>ready</em> requests.</p>
<p>To terminate the chain the client supplies data with a <em>last</em> indication asserted.</p>
<p>To ease implementation of the client, the request includes a <em>first</em> indicator and an <em>led_number</em> indicator - effectively a client can read a register file based on <em>led_number</em> and drive <em>valid</em> when the data is valid, and <em>last</em> if led_number matches the end of the register file.</p>
<p>This module copes with all of the requirements of the Neopixel chain, and it takes a constant clock input. To provide the correct frequency of data pin toggling to the Neopixels a clock divider value must be supplied, with the approximate number of clock ticks that make up 400ns (ideally 408ns).</p>
<p>The Neopixel WS2812 LED chains use a serial data stream with encoded clock to provide data to the LEDs.</p>
<p>If the LED chain data is held low for &gt;50us then the stream performs a 'load to LEDs' - this transfers the serial data already loaded in to the LEDs to the actual LED drivers themselves.</p>
<p>Before loading the LEDs the chain should be fed data. The data is fed using a high/low data pulse per bit. The ratio high/low provides the data bit value.</p>
<p>A high/low of 1:2 provids a zero bit; a high/low of 1:2 provides a one bit. The total bit time should be 1.25us. Hence this logic requires a 1.25/3us, or roughly 400ns clock generator. This is performed using a clock divider and a user-supplied divide value, which will depend on the input clock frequency. For example, if the input clock frequency is 50MHz, which is a period of 20ns, then the divider should be set to 20.</p>
<p>The data is provided to the LEDs green, red then blue, most significant bit first, with 8 bits for each component.</p>
<p>The logic uses a simple state machine; when it is idle it will have no data in hand, and need data to feed in to the LED stream. At this point it requests a valid first LED data. When valid data is received into a buffer the state machine transitions to the data-in-hand state; it remains there until the data transmitter takes the data, when it either requests more data (as per idle), or if the last LED data was provided by the client, it moves to requests an LED load, and it waits in loading state until that completes. At this point it transitions back to idle, and the process restarts.</p>
<p>When there is valid LED data in the internal buffer the data transmitter can start; the data is transferred to the shift register, and it is driven out by the data transmitter to the LED chain one bit at a time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">clk</td><td>System clock - not the pin clock, which is derived from this </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">reset_n</td><td>Active low reset </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">divider_400ns</td><td>clock divider value to provide for generating a pulse every 400ns based on clk </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">led_request</td><td>LED data request, to get data from the next LED to light </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">led_data</td><td>LED data, for the requested led </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">led_chain</td><td>Data pin for LED chain, modulated by this module to drive LED settings </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Sep 30 2018 17:21:43 for CDL Modules by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
